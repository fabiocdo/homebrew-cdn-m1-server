root /app/data;

location = / {
  return 302 /store.db;
}

location = /store.db {
  default_type application/octet-stream;
  add_header Accept-Ranges bytes always;
  add_header Cache-Control "no-store" always;
  gzip off;
  try_files $uri =404;
}

location = /update/remote.md5 {
  default_type text/plain;
  add_header Cache-Control "no-store" always;
  try_files /_cache/remote.md5 =404;
}

location = /api.php {
  default_type application/json;
  add_header Cache-Control "no-store" always;
  try_files /_cache/store.db.json =404;
}

location = /update/homebrew.elf {
  default_type application/octet-stream;
  add_header Cache-Control "no-store" always;
  try_files /_cache/homebrew.elf =404;
}

location = /update/homebrew.elf.sig {
  default_type application/octet-stream;
  add_header Cache-Control "no-store" always;
  try_files /_cache/homebrew.elf.sig =404;
}

location = /update/store.prx {
  default_type application/octet-stream;
  add_header Cache-Control "no-store" always;
  try_files /_cache/store.prx =404;
}

location = /update/store.prx.sig {
  default_type application/octet-stream;
  add_header Cache-Control "no-store" always;
  try_files /_cache/store.prx.sig =404;
}

location ~* ^/pkg/.*\.pkg$ {
  try_files $uri =404;
  default_type application/octet-stream;
  add_header Accept-Ranges bytes always;
  add_header Cache-Control "public, max-age=31536000, immutable" always;
  gzip off;
}

location ~* ^/pkg/.*\.(png|jpg|jpeg|webp)$ {
  try_files $uri =404;
  add_header Cache-Control "public, max-age=2592000" always;
}

location ~* ^/pkg/.*\.(json|db)$ {
  try_files $uri =404;
  add_header Cache-Control "no-store" always;
  gzip off;
}

location ^~ /pkg/ {
  try_files $uri =404;
}

location / {
  try_files $uri $uri/ =404;
}
